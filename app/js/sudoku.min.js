"use strict";var app=angular.module("sudoku",[]);app.controller("mainCtrl",["$scope","Board","Region","Tile",function(a,b){a.board=new b,a.board.loadDefault()}]),app.factory("Board",["$http","Region",function(a,b){var c=function(){this.regions=[],this.validated=!0};return c.prototype={loadDefault:function(){var c=this;a.get("js/data/puzzle.js").success(function(a){a.forEach(function(a,d){var e=new b(d);e.load(a.region),c.regions.push(e)})})},loadRandom:function(){},hideTileOptions:function(){this.regions.forEach(function(a){a.hideTileOptions()})},selectTileOption:function(a,b,c){a.selectTileOption(b,c),this.validate(a,b,c)},validate:function(a,b,c){a.validate(b,c);for(var d=0;3>d;d++)this.regions[3*a.getRow()+d]!=a&&this.regions[3*a.getRow()+d].validateTileRow(b,c),this.regions[3*d+a.getCol()]!=a&&this.regions[3*d+a.getCol()].validateTileCol(b,c)},toggleValidation:function(){this.validated=this.validated?!1:!0},reset:function(){this.regions.forEach(function(a){a.reset()})}},c}]),app.factory("Option",[function(){var a=function(a){this.number=a,this.enable=!0,this.selected=null,this.reset()};return a.prototype={select:function(){this.selected=this.selected?!1:!0},reset:function(){this.selected=!1}},a}]),app.factory("Region",["Tile",function(a){var b=function(a){this.id=a,this.tiles=[],this.reset()};return b.prototype={load:function(b){var c=this;b.forEach(function(b,d){var e=new a(d,b.val,b.def);c.tiles.push(e)})},getRow:function(){return Math.ceil((this.id-1)/3+.5)-1},getCol:function(){return this.id%3},hideTileOptions:function(){this.tiles.forEach(function(a){a.hideOptions()})},selectTileOption:function(a,b){a.selectOption(b)},validate:function(a,b){this.validateTileSet(a,b,this.tiles,1)},validateTileRow:function(a,b){for(var c=[],d=0;3>d;d++)c.push(this.tiles[3*a.getRow()+d]);this.validateTileSet(a,b,c,b.selected?0:1)},validateTileCol:function(a,b){for(var c=[],d=0;3>d;d++)c.push(this.tiles[3*d+a.getCol()]);this.validateTileSet(a,b,c,b.selected?0:1)},validateTileSet:function(a,b,c,d){var e=[];c.forEach(function(a){a.guesses.forEach(function(c){b.number==c&&e.push(a)})});var f=e.length>d?!1:!0;e.forEach(function(a){a.valid=f})},reset:function(){this.valid=!0,this.tiles.forEach(function(a){a.reset()})}},b}]),app.factory("Tile",["Option",function(a){var b=function(b,c,d){this.id=b,this.answer=c,this.lock=d,this.guesses=null,this.showingOptions=null,this.options=[],this.valid=!0;for(var e=0;9>e;e++)this.options.push(new a(e+1));this.reset()};return b.prototype={getRow:function(){return Math.ceil((this.id-1)/3+.5)-1},getCol:function(){return this.id%3},showOptions:function(){this.showingOptions=!0},hideOptions:function(){return this.guesses.length>1?!1:void(this.showingOptions=!1)},selectOption:function(a){a.select(),this.updateGuess(a)},updateGuess:function(a){if(a.selected)this.guesses.push(a.number);else{var b=this.guesses.indexOf(a.number);this.guesses.splice(b,1)}},reset:function(){this.guesses=this.lock?[this.answer]:[],this.showingOptions=!1,this.valid=!0,this.options.forEach(function(a){a.reset()})}},b}]);