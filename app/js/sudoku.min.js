function Board(a){this.obj=$(a),this.regions=[],this.validated=!0,this.timer,this.stop,this.win,this.loaded;var b,c=$(".play.modal"),d=$(".play.modal .button.load"),e=$(".win.modal"),f=$(".button.reset"),g=$(".button.validate"),h=$(".global-timer"),i=$("body");this.init=function(){for(var a=8;a>=0;a--)this.regions[a]=new Region(a,this),this.obj.prepend(this.regions[a].obj);b=$(this.obj).find(".options-toggle"),d.on("click",{scope:this},function(a){a.data.scope.loadDefault(a.data.scope)}),g.on("click",{scope:this},function(a){a.data.scope.toggleValidation()}),f.on("click",{scope:this},function(a){a.data.scope.reset()}),b.on("click",{scope:this},function(a){a.data.scope.hideTileOptions()})},this.loadDefault=function(a){this.loaded=!0,$.ajax({dataType:"json",url:"js/data/puzzle.js",success:function(b){b.forEach(function(b,c){a.regions[c].load(b.region)}),a.reset()}})},this.loadRandom=function(){this.loaded=!0,this.startTimer()},this.updateTimer=function(){h.html(this.formatTime())},this.updateView=function(){this.updateTimer(),this.win&&!e.hasClass("show")?e.addClass("show"):!this.win&&e.hasClass("show")&&e.removeClass("show"),this.loaded||c.hasClass("show")?this.loaded&&c.hasClass("show")&&c.removeClass("show"):c.addClass("show"),this.validated&&!i.hasClass("hints")?i.addClass("hints"):!this.validated&&i.hasClass("hints")&&i.removeClass("hints")},this.formatTime=function(){var a=Math.floor(this.timer/60),b=Math.floor(this.timer%60);return b=b.toString().length<2?"0"+b:b,a+":"+b},this.hideTileOptions=function(){this.regions.forEach(function(a){a.hideTileOptions()})},this.selectTileOption=function(a,b,c){a.selectTileOption(b,c),this.validateTile(a,b,[],c),this.checkWin(),this.updateView(),b.updateView()},this.validateTile=function(a,b,c,d){var e=this;d&&!d.selected&&e.validateGuess(a,b,d.number,c),b.guesses.forEach(function(d){e.validateGuess(a,b,d,c)}),0==b.guesses.length&&(b.valid=!0)},this.validateGuess=function(a,b,c,d){var e=a.validateTile(b,c);this.validateSet(a,b,c,e,d);for(var f=0;3>f;f++){var g=this.regions[a.getCol()+3*f],h=this.regions[3*a.getRow()+f];if(g!=a){var e=g.validateTileCol(b,c);this.validateSet(g,b,c,e,d)}if(h!=a){var e=h.validateTileRow(b,c);this.validateSet(h,b,c,e,d)}}},this.validateSet=function(a,b,c,d,e){var f=this;0==b.guesses.length?b.valid=!0:d.length>0&&-1==e.indexOf(b)?(e.push(b),b.valid=!1):-1==e.indexOf(b)&&(b.valid=!0),d.forEach(function(b){-1==e.indexOf(b)&&f.validateTile(a,b,e,void 0)})},this.toggleValidation=function(){this.validated=this.validated?!1:!0,this.updateView()},this.checkWin=function(){var a=!0;this.regions.forEach(function(b){b.tiles.forEach(function(b){(1!=b.guesses.length||b.guesses[0]!=b.answer)&&(a=!1)})}),this.win=a},this.startTimer=function(){var a=this;this.stop=setInterval(function(){return a.win?(a.stop=void 0,!0):(a.timer++,void a.updateView())},1e3)},this.reset=function(){this.timer=0,clearInterval(this.stop),this.stop=void 0,this.win=!1,this.loaded&&this.startTimer(),this.regions.forEach(function(a){a.reset()}),this.updateView()},this.reset(),this.init()}function Option(a,b){this.number=a,this.tile=b,this.obj=$("<div class = 'option'>		<div class = 'resp'>			<div class = 'v-align'>				<span>"+this.number+"</span>			</div>		</div>	</div>"),this.enable=!0,this.selected=null,this.init=function(){this.obj.on("click",{scope:this},function(a){return a.data.scope.tile.showingOptions?void a.data.scope.tile.region.board.selectTileOption(a.data.scope.tile.region,a.data.scope.tile,a.data.scope):!0})},this.updateView=function(){this.selected&&!this.obj.hasClass("selected")?this.obj.addClass("selected"):!this.selected&&this.obj.hasClass("selected")&&this.obj.removeClass("selected")},this.select=function(){this.selected=this.selected?!1:!0,this.updateView()},this.reset=function(){this.selected=!1,this.updateView()},this.reset(),this.init()}function Region(a,b){this.id=a,this.board=b,this.obj=$("<div class = 'region'>		<div class = 'resp'></div>	</div>"),this.obj_inner=".resp",this.tiles=[],this.init=function(){for(var a=8;a>=0;a--)this.tiles[a]=new Tile(a,0,!1,this),this.obj.children(this.obj_inner).prepend(this.tiles[a].obj)},this.load=function(a){var b=this;a.forEach(function(a,c){b.tiles[c].load(a),b.updateView()})},this.updateView=function(){},this.getRow=function(){return Math.ceil((this.id-1)/3+.5)-1},this.getCol=function(){return this.id%3},this.hideTileOptions=function(){this.tiles.forEach(function(a){a.hideOptions()})},this.selectTileOption=function(a,b){a.selectOption(b)},this.validateTile=function(a,b){var c=[];return this.tiles.forEach(function(b){b!=a&&c.push(b)}),this.validateTileSet(a,b,c)},this.validateTileRow=function(a,b){for(var c=[],d=0;3>d;d++)this.tiles[3*a.getRow()+d].guesses.length>0&&c.push(this.tiles[3*a.getRow()+d]);return this.validateTileSet(a,b,c)},this.validateTileCol=function(a,b){for(var c=[],d=0;3>d;d++)this.tiles[a.getCol()+3*d].guesses.length>0&&c.push(this.tiles[a.getCol()+3*d]);return this.validateTileSet(a,b,c)},this.validateTileSet=function(a,b,c){var d=[];return c.forEach(function(a){a.guesses.forEach(function(c){b==c&&d.push(a)})}),d},this.reset=function(){this.valid=!0,this.tiles.forEach(function(a){a.reset()}),this.updateView()},this.reset(),this.init()}function Tile(a,b,c,d){this.id=a,this.region=d,this.obj=$("<div class = 'tile'>		<div class = 'resp'>			<div class = 'v-align options-toggle'>				<span class = 'guess'></span>				<div class = 'options'></div>				<div class = 'caret'></div>			</div>		</div>	</div>"),this.obj_inner=".options",this.answer=b,this.lock=c,this.guesses=null,this.showingOptions=null,this.options=[],this.valid=!0;var e=$(this.obj).find(".guess"),f=$(this.obj).find(".options"),g=$(this.obj).find(".options-toggle");this.init=function(){for(var a=8;a>=0;a--)this.options[a]=new Option(a+1,this),this.obj.find(this.obj_inner).prepend(this.options[a].obj)},this.load=function(a){this.answer=a.val,this.lock=a.def,g.on("click",{scope:this},function(a){a.data.scope.showOptions()}),this.reset()},this.updateView=function(){this.lock&&!this.obj.hasClass("locked")&&this.obj.addClass("locked"),this.showingOptions&&!f.hasClass("show")?f.addClass("show"):!this.showingOptions&&f.hasClass("show")&&f.removeClass("show"),this.valid||this.obj.hasClass("invalid")?this.valid&&this.obj.hasClass("invalid")&&this.obj.removeClass("invalid"):this.obj.addClass("invalid"),e.html(1==this.guesses.length?this.guesses[0]:"")},this.getRow=function(){return Math.ceil((this.id-1)/3+.5)-1},this.getCol=function(){return this.id%3},this.showOptions=function(){return this.lock?!0:(this.showingOptions=!0,void this.updateView())},this.hideOptions=function(){return this.guesses.length>1?!1:(this.showingOptions=!1,void this.updateView())},this.selectOption=function(a){a.select(),this.updateGuess(a)},this.updateGuess=function(a){if(a.selected)this.guesses.push(a.number);else{var b=this.guesses.indexOf(a.number);this.guesses.splice(b,1)}this.updateView()},this.reset=function(){this.guesses=this.lock?[this.answer]:[],this.showingOptions=!1,this.valid=!0,this.options.forEach(function(a){a.reset()}),this.updateView()},this.reset(),this.init()}$(document).ready(function(){new Board("#sudoku-board")});