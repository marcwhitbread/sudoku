"use strict";var app=angular.module("sudoku",[]);app.controller("mainCtrl",["$scope","Board","Region","Tile",function(a,b){a.board=new b}]),app.factory("Board",["$http","$interval","Region",function(a,b,c){var d=function(){this.regions=[],this.validated=!0,this.timer,this.stop,this.win,this.loaded,this.reset(),this.init()};return d.prototype={init:function(){for(var a=0;9>a;a++)this.regions.push(new c(a))},loadDefault:function(){this.loaded=!0;var b=this;a.get("js/data/puzzle.js").success(function(a){a.forEach(function(a,c){b.regions[c].load(a.region)}),b.reset()})},loadRandom:function(){this.loaded=!0,this.startTimer()},hideTileOptions:function(){this.regions.forEach(function(a){a.hideTileOptions()})},selectTileOption:function(a,b,c){a.selectTileOption(b,c),this.validateTile(a,b,[],c),this.win=this.checkWin()},validateTile:function(a,b,c,d){var e=this;d&&!d.selected&&e.validateGuess(a,b,d.number,c),b.guesses.forEach(function(d){e.validateGuess(a,b,d,c)}),0==b.guesses.length&&(b.valid=!0)},validateGuess:function(a,b,c,d){var e=a.validateTile(b,c);this.validateSet(a,b,c,e,d);for(var f=0;3>f;f++){var g=this.regions[a.getCol()+3*f],h=this.regions[3*a.getRow()+f];if(g!=a){var e=g.validateTileCol(b,c);this.validateSet(g,b,c,e,d)}if(h!=a){var e=h.validateTileRow(b,c);this.validateSet(h,b,c,e,d)}}},validateSet:function(a,b,c,d,e){var f=this;0==b.guesses.length?b.valid=!0:d.length>0&&-1==e.indexOf(b)?(e.push(b),b.valid=!1):-1==e.indexOf(b)&&(b.valid=!0),d.forEach(function(b){-1==e.indexOf(b)&&f.validateTile(a,b,e,void 0)})},toggleValidation:function(){this.validated=this.validated?!1:!0},checkWin:function(){var a=!0;return this.regions.forEach(function(b){b.tiles.forEach(function(b){(1!=b.guesses.length||b.guesses[0]!=b.answer)&&(a=!1)})}),a},startTimer:function(){var a=this;this.stop=b(function(){return a.win?(a.stop=void 0,!0):void a.timer++},1e3)},reset:function(){this.timer=0,b.cancel(this.stop),this.stop=void 0,this.win=!1,this.loaded&&this.startTimer(),this.regions.forEach(function(a){a.reset()})}},d}]),app.factory("Option",[function(){var a=function(a){this.number=a,this.enable=!0,this.selected=null,this.reset()};return a.prototype={select:function(){this.selected=this.selected?!1:!0},reset:function(){this.selected=!1}},a}]),app.factory("Region",["Tile",function(a){var b=function(a){this.id=a,this.tiles=[],this.reset(),this.init()};return b.prototype={init:function(){for(var b=0;9>b;b++)this.tiles.push(new a(b,0,!1))},load:function(a){var b=this;a.forEach(function(a,c){b.tiles[c].load(a)})},getRow:function(){return Math.ceil((this.id-1)/3+.5)-1},getCol:function(){return this.id%3},hideTileOptions:function(){this.tiles.forEach(function(a){a.hideOptions()})},selectTileOption:function(a,b){a.selectOption(b)},validateTile:function(a,b){var c=[];return this.tiles.forEach(function(b){b!=a&&c.push(b)}),this.validateTileSet(a,b,c)},validateTileRow:function(a,b){for(var c=[],d=0;3>d;d++)this.tiles[3*a.getRow()+d].guesses.length>0&&c.push(this.tiles[3*a.getRow()+d]);return this.validateTileSet(a,b,c)},validateTileCol:function(a,b){for(var c=[],d=0;3>d;d++)this.tiles[a.getCol()+3*d].guesses.length>0&&c.push(this.tiles[a.getCol()+3*d]);return this.validateTileSet(a,b,c)},validateTileSet:function(a,b,c){var d=[];return c.forEach(function(a){a.guesses.forEach(function(c){b==c&&d.push(a)})}),d},reset:function(){this.valid=!0,this.tiles.forEach(function(a){a.reset()})}},b}]),app.factory("Tile",["Option",function(a){var b=function(b,c,d){this.id=b,this.answer=c,this.lock=d,this.guesses=null,this.showingOptions=null,this.options=[],this.valid=!0;for(var e=0;9>e;e++)this.options.push(new a(e+1));this.reset()};return b.prototype={load:function(a){this.answer=a.val,this.lock=a.def,this.reset()},getRow:function(){return Math.ceil((this.id-1)/3+.5)-1},getCol:function(){return this.id%3},showOptions:function(){this.showingOptions=!0},hideOptions:function(){return this.guesses.length>1?!1:void(this.showingOptions=!1)},selectOption:function(a){a.select(),this.updateGuess(a)},updateGuess:function(a){if(a.selected)this.guesses.push(a.number);else{var b=this.guesses.indexOf(a.number);this.guesses.splice(b,1)}},reset:function(){this.guesses=this.lock?[this.answer]:[],this.showingOptions=!1,this.valid=!0,this.options.forEach(function(a){a.reset()})}},b}]);var filterTime=function(){return function(a){var b=Math.floor(a/60),c=Math.floor(a%60);return c=c.toString().length<2?"0"+c:c,b+":"+c}};app.filter("filterTime",filterTime);